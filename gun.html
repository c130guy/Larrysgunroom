<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Firearm Details | Larry’s Gun Room</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <style>
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 20px;
    }
    .gallery img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      cursor: pointer;
      border-radius: 6px;
    }

    /* Lightbox */
    .lightbox {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .lightbox img {
      max-width: 95%;
      max-height: 95%;
    }
    .lightbox.active {
      display: flex;
    }
  </style>
</head>
<body>

<a href="/" style="display:block; margin:20px;">← Back to Inventory</a>

<main id="gun">
  <p>Loading firearm details…</p>
</main>

<div id="lightbox" class="lightbox" onclick="this.classList.remove('active')">
  <img id="lightbox-img">
</div>

<script>
/* ================= CONFIG ================= */

const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQABes-BmlnfiQ4tB8tWX6Z0MNRv_rhDJjc4qomYnmuCy-xgJdt81dReyVPT7ZGAu5Mclw_sgZDZ_a/pub?gid=0&single=true&output=csv";

const API_KEY = "AIzaSyBF6oEWQAiqJcKyFfJFUJelQgOldL1ZWQg";

/* =============== DO NOT EDIT BELOW =============== */

const params = new URLSearchParams(window.location.search);
const id = params.get("id");

if (!id) {
  document.getElementById("gun").innerHTML = "<p>Invalid firearm link.</p>";
} else {

  fetch(SHEET_URL)
    .then(res => res.text())
    .then(csv => {

      const rows = csv.trim().split("\n").slice(1).map(r =>
        r.split(",").map(c => c.trim().replace(/^"|"$/g, ""))
      );

      const gun = rows.find(r => r[0] === id);

      if (!gun) {
        document.getElementById("gun").innerHTML = "<p>Firearm not found.</p>";
        return;
      }

      const name    = gun[1];
      const price   = gun[2];
      const status  = gun[3];
      const details = gun[4];
      const folder  = gun[5];

      let badge = status === "SOLD"
        ? "<div class='badge'>SOLD</div>"
        : "";

      document.getElementById("gun").innerHTML = `
        <h1>${name}</h1>
        ${badge}
        <p class="price">$${price}</p>
        <p>${details}</p>
        <div class="gallery" id="gallery"></div>
      `;

      const match = folder.match(/[-\w]{25,}/);
      if (!match) return;

      const folderId = match[0];

      fetch(
        `https://www.googleapis.com/drive/v3/files` +
        `?q='${folderId}' in parents` +
        `&spaces=drive` +
        `&supportsAllDrives=true` +
        `&includeItemsFromAllDrives=true` +
        `&orderBy=name` +
        `&fields=files(id,name)` +
        `&key=${API_KEY}`
      )
      .then(r => r.json())
      .then(data => {
        const gallery = document.getElementById("gallery");
        if (!data.files || !data.files.length) {
          gallery.innerHTML = "<em>No photos available.</em>";
          return;
        }

        data.files.forEach(f => {
          const img = document.createElement("img");
          img.src = `https://drive.google.com/thumbnail?id=${f.id}&sz=w1000`;
          img.onclick = () => {
            document.getElementById("lightbox-img").src = img.src;
            document.getElementById("lightbox").classList.add("active");
          };
          gallery.appendChild(img);
        });
      });
    });
}
</script>

</body>
</html>


