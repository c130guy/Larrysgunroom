<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Larry’s Gun Room | Beresford, SD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    /* SOLD visual treatment */
    .item-card.sold {
      opacity: 0.5;
      pointer-events: auto;
    }
    .sold-ribbon {
      position: absolute;
      top: 10px;
      left: -5px;
      background: #b00020;
      color: white;
      padding: 5px 12px;
      font-weight: bold;
      font-size: 0.85rem;
      transform: rotate(-5deg);
      z-index: 2;
    }
    .image-wrapper {
      position: relative;
    }
  </style>
</head>
<body>

<header class="hero">
  <h1>Larry’s Gun Room</h1>
  <p>Collecting, Dealing & Trading Since 1969</p>
</header>

<section id="inventory" class="inventory-grid">
  <p>Loading inventory…</p>
</section>

<footer>
  <p>© Larry’s Gun Room, LLC — Beresford, South Dakota</p>
</footer>

<script>
/* ================= CONFIG ================= */

const SHEET_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQABes-BmlnfiQ4tB8tWX6Z0MNRv_rhDJjc4qomYnmuCy-xgJdt81dReyVPT7ZGAu5Mclw_sgZDZ_a/pub?gid=0&single=true&output=csv";

const API_KEY = "AIzaSyBF6oEWQAiqJcKyFfJFUJelQgOldL1ZWQg";

/* =============== DO NOT EDIT BELOW =============== */

fetch(SHEET_URL)
  .then(res => res.text())
  .then(csv => {

    const rows = csv.trim().split("\n").slice(1);
    const container = document.getElementById("inventory");
    container.innerHTML = "";

    rows.forEach(row => {
      const cols = row.split(",").map(c => c.trim().replace(/^"|"$/g, ""));

      const id     = cols[0];
      const name   = cols[1];
      const price  = cols[2];
      const status = (cols[3] || "").toUpperCase();
      const folder = cols[5] || "";

      if (!id || !name) return;

      const card = document.createElement("a");
      card.className = "item-card";
      card.href = `/gun.html?id=${id}`;

      if (status === "SOLD") {
        card.classList.add("sold");
      }

      card.innerHTML = `
        <div class="image-wrapper">
          ${status === "SOLD" ? "<div class='sold-ribbon'>SOLD</div>" : ""}
          <div class="no-image">No Photo</div>
        </div>
        <h3>${name}</h3>
        <p class="price">$${price}</p>
      `;

      container.appendChild(card);

      const match = folder.match(/[-\w]{25,}/);
      if (!match) return;

      const folderId = match[0];

      fetch(
        `https://www.googleapis.com/drive/v3/files` +
        `?q='${folderId}' in parents` +
        `&spaces=drive` +
        `&supportsAllDrives=true` +
        `&includeItemsFromAllDrives=true` +
        `&orderBy=name` +
        `&pageSize=1` +
        `&fields=files(id)` +
        `&key=${API_KEY}`
      )
      .then(r => r.json())
      .then(data => {
        if (data.files && data.files.length) {
          const imgId = data.files[0].id;
          card.querySelector(".image-wrapper").innerHTML =
            `${status === "SOLD" ? "<div class='sold-ribbon'>SOLD</div>" : ""}` +
            `<img src="https://drive.google.com/thumbnail?id=${imgId}&sz=w400">`;
        }
      });
    });

    if (!container.children.length) {
      container.innerHTML = "<p>No inventory available.</p>";
    }
  })
  .catch(() => {
    document.getElementById("inventory").innerHTML =
      "<p>Error loading inventory.</p>";
  });
</script>

</body>
</html>







